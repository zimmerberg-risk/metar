---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  fig.width = 9,
  fig.height = 6
)
```

# metar

The goal of **metar** is to provide an R-built parser for METAR reports. Find more information about METAR under https://en.wikipedia.org/wiki/METAR

## Installation

Install the development version from [GitHub](https://github.com/m-saenger/metar) with:

``` r
# install.packages("devtools") 
devtools::install_github("m-saenger/metar", upgrade = "never")
```

Install the latest stable version from [GitHub](https://github.com/m-saenger/metar/tags) with:

``` r
# install.packages("devtools") 
devtools::install_github("m-saenger/metar@0.3.1", upgrade = "never")
```

This package depends on **data.table**, **stringr**, **readr** and **lubridate**.

## Example

### Data retrieval and parsing

```{r example}
library(metar)

## read raw data from Mesonet website
dat <- read_mesonet("LSZH", as.POSIXct("2021-03-15"), as.POSIXct("2021-03-28"))

## parse METAR code
dat.parsed <- parse_metar(dat$metar, date = dat$valid)

# Structure  (subset of columns)
print(dat.parsed[1:10, .(metar, tt, qnh)])

```

### Variable names

```{r Variable}

library(data.table)
vars <- data.table::rbindlist(metar.vars, fill = TRUE, idcol = "short_name")
print(vars[, .(short_name, name)])


```


### Example plot

```{r plot1}
library(ggplot2)
ggplot(dat.parsed, aes(time, tt)) +
  geom_path() +
  labs(title = "Recent Temperature at LSZH Airport") +
  theme_bw()

```

### Data processing (cloud groups)

```{r plot2}
# Process cloud groups (1-4)
dat.cld <- metar_clouds(dat.parsed$cl)    
dat.cld$time <- dat.parsed$time

# Structure (subset of columns)
print(dat.cld[1:10, .(time, cld_levels, cld_str_1 , cld_amt_1, cld_hgt_1, cld_type_1 )])

ggplot(dat.cld, aes(time, cld_hgt_1)) +
  geom_path() +
  labs(title = "Altitude of Lowest Cloud Level at LSZH Airport") +
  theme_bw()

```

### METARgram - Timeseries

```{r plot3}
# Parse present weather group
dat.pw <- dat.parsed[, metar_pw(pw)]

# Structure (subset of columns)
print(dat.pw[1:10, .(pw_grp_1, pw_grp_2, is_pp, RA, SN, DZ, is_solid, is_liquid, is_mixed)])

# Bind data
dat.plot <- cbind(dat.parsed, dat.pw)

plot_metargram(dat = dat.plot, cex = 0.8)


```



