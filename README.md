
<!-- README.md is generated from README.Rmd. Please edit that file -->

# metar

The goal of **metar** is to provide an R-built parser for METAR reports.

## Installation

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("m-saenger/metar")
```

## Example

### Data retrieval and parsing

``` r
library(metar)
## read raw data from Mesonet website
dat <- read_mesonet(id_icao = "LSZH", date_start = "2021-03-06", date_end = "2021-03-28")
## parse METAR code
dat.parsed <- parse_metar(x = dat$metar, date = dat$valid)
# Structure
str(dat.parsed)
#> Classes 'data.table' and 'data.frame':   1032 obs. of  35 variables:
#>  $ icao       : chr  "LSZH" "LSZH" "LSZH" "LSZH" ...
#>  $ time       : POSIXct, format: "2021-03-06 00:50:00" "2021-03-06 01:20:00" ...
#>  $ speci      : chr  "0" "0" "0" "0" ...
#>  $ auto       : chr  "0" "0" "0" "0" ...
#>  $ cor        : chr  "0" "0" "0" "0" ...
#>  $ wx         : chr  NA NA NA NA ...
#>  $ dir        : int  70 80 90 70 70 70 70 NA 340 NA ...
#>  $ ff         : num  5 7 5 6 5 4 4 5 5 3 ...
#>  $ fx         : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ ff_unit    : chr  "KT" "KT" "KT" "KT" ...
#>  $ dir_from   : int  20 40 40 30 20 360 30 NA 260 NA ...
#>  $ dir_to     : int  150 110 140 90 130 120 130 NA 60 NA ...
#>  $ vis        : num  9999 9999 9999 9999 9999 ...
#>  $ vis_unit   : chr  "M" "M" "M" "M" ...
#>  $ ndv        : chr  NA NA NA NA ...
#>  $ min_vis    : int  NA NA NA NA NA NA NA NA NA NA ...
#>  $ min_vis_dir: chr  NA NA NA NA ...
#>  $ rvr        : chr  "" "" "" "" ...
#>  $ vvis       : chr  NA NA NA NA ...
#>  $ cld        : chr  "SCT022" "SCT024" "BKN022" "BKN022" ...
#>  $ tt_sign    : chr  "P" "P" "P" "P" ...
#>  $ tt         : num  2 1 1 1 1 1 1 1 1 1 ...
#>  $ td_sign    : chr  "M" "M" "M" "M" ...
#>  $ td         : num  -2 -3 -3 -3 -3 -2 -3 -3 -3 -3 ...
#>  $ pw         : chr  "" "" "" "" ...
#>  $ qnh_unit   : chr  "Q" "Q" "Q" "Q" ...
#>  $ qnh        : num  1027 1027 1027 1027 1027 ...
#>  $ ws         : chr  NA NA NA NA ...
#>  $ metar      : chr  "07005KT 020V150 9999 SCT022 02/M02 Q1027 NOSIG" "08007KT 040V110 9999 SCT024 01/M03 Q1027 NOSIG" "09005KT 040V140 9999 BKN022 01/M03 Q1027 NOSIG" "07006KT 030V090 9999 BKN022 01/M03 Q1027 NOSIG" ...
#>  $ rmk        : chr  NA NA NA NA ...
#>  $ wind_factor: num  1 1 1 1 1 1 1 1 1 1 ...
#>  $ vis_factor : num  1 1 1 1 1 1 1 1 1 1 ...
#>  $ qnh_factor : num  1 1 1 1 1 1 1 1 1 1 ...
#>  $ tt_factor  : num  1 1 1 1 1 1 1 1 1 1 ...
#>  $ td_factor  : num  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
#>  - attr(*, ".internal.selfref")=<externalptr>
```

### Example plot

``` r
library(ggplot2)
#> Warning: package 'ggplot2' was built under R version 4.0.4
ggplot(dat.parsed, aes(time, tt)) +
  geom_path() +
  labs(title = "Recent Temperature at LSZH Airport") +
  theme_bw()
```

<img src="man/figures/README-plot1-1.png" width="100%" />

### Data processing (cloud groups)

``` r
# Process cloud groups (1-4)
dat.cld <- metar_clouds(dat.parsed$cl)    
dat.cld$time <- dat.parsed$time
# Structure
str(dat.cld)
#> Classes 'data.table' and 'data.frame':   1032 obs. of  23 variables:
#>  $ cld_levels : int  1 1 1 1 1 1 1 1 1 1 ...
#>  $ cld_hgt_min: num  2200 2400 2200 2200 2300 2100 2000 1900 1800 1800 ...
#>  $ cld_hgt_max: num  2200 2400 2200 2200 2300 2100 2000 1900 1800 1800 ...
#>  $ cld_amt_max: chr  "SCT" "SCT" "BKN" "BKN" ...
#>  $ cld_amt_min: chr  "SCT" "SCT" "BKN" "BKN" ...
#>  $ ceiling    : num  NA NA 2200 2200 2300 2100 2000 1900 1800 1800 ...
#>  $ cld_str_1  : chr  "SCT022" "SCT024" "BKN022" "BKN022" ...
#>  $ cld_str_2  : chr  NA NA NA NA ...
#>  $ cld_str_3  : chr  NA NA NA NA ...
#>  $ cld_str_4  : chr  NA NA NA NA ...
#>  $ cld_amt_1  : chr  "SCT" "SCT" "BKN" "BKN" ...
#>  $ cld_amt_2  : chr  NA NA NA NA ...
#>  $ cld_amt_3  : chr  NA NA NA NA ...
#>  $ cld_amt_4  : chr  NA NA NA NA ...
#>  $ cld_hgt_1  : num  2200 2400 2200 2200 2300 2100 2000 1900 1800 1800 ...
#>  $ cld_hgt_2  : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_hgt_3  : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_hgt_4  : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_type_1 : chr  NA NA NA NA ...
#>  $ cld_type_2 : chr  NA NA NA NA ...
#>  $ cld_type_3 : chr  NA NA NA NA ...
#>  $ cld_type_4 : chr  NA NA NA NA ...
#>  $ time       : POSIXct, format: "2021-03-06 00:50:00" "2021-03-06 01:20:00" ...
#>  - attr(*, ".internal.selfref")=<externalptr>
ggplot(dat.cld, aes(time, cld_hgt_1)) +
  geom_path() +
  labs(title = "Altitude of Lowest Cloud Level at LSZH Airport") +
  theme_bw()
```

<img src="man/figures/README-plot2-1.png" width="100%" />

### METARgram

``` r
dat.1 <- cbind(dat.parsed, dat.parsed[, metar_pw(pw)])
plot_metargram(dat = dat.1, cex = .8)
```

<img src="man/figures/README-plot3-1.png" width="100%" />
