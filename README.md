
<!-- README.md is generated from README.Rmd. Please edit that file -->

# metar

The goal of **metar** is to provide an R-built parser for METAR reports.

## Installation

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools") 
devtools::install_github("m-saenger/metar")
```

## Example

### Data retrieval and parsing

``` r
library(metar)

## read raw data from Mesonet website
dat <- read_mesonet("LSZH", as.POSIXct("2021-03-26"), as.POSIXct("2021-03-28"))

## parse METAR code
dat.parsed <- parse_metar(dat$metar)

# Structure
str(dat.parsed)
#> Classes 'data.table' and 'data.frame':   94 obs. of  24 variables:
#>  $ icao       : chr  "LSZH" "LSZH" "LSZH" "LSZH" ...
#>  $ time       : POSIXct, format: "2021-04-25 00:50:00" "2021-04-25 01:20:00" ...
#>  $ auto       : chr  "0" "0" "0" "0" ...
#>  $ cor        : chr  "0" "0" "0" "0" ...
#>  $ wx         : chr  "CAVOK" "CAVOK" "CAVOK" "CAVOK" ...
#>  $ dir        : int  240 0 0 300 NA NA NA NA NA 130 ...
#>  $ ff         : num  1 0 0 1 1 1 1 1 1 2 ...
#>  $ fx         : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ dir_from   : int  NA NA NA NA NA NA NA NA NA NA ...
#>  $ dir_to     : int  NA NA NA NA NA NA NA NA NA NA ...
#>  $ vis        : num  9999 9999 9999 9999 9999 ...
#>  $ ndv        : chr  NA NA NA NA ...
#>  $ min_vis    : int  NA NA NA NA NA NA NA NA NA NA ...
#>  $ min_vis_dir: chr  NA NA NA NA ...
#>  $ rvr        : chr  "" "" "" "" ...
#>  $ vvis       : chr  NA NA NA NA ...
#>  $ cld        : chr  "" "" "" "" ...
#>  $ tt         : num  1 1 0 1 0 0 0 -1 -1 -1 ...
#>  $ td         : num  -1 0 -1 -1 -1 -1 -1 -2 -2 -2 ...
#>  $ pw         : chr  "" "" "" "" ...
#>  $ qnh        : num  1023 1023 1022 1022 1022 ...
#>  $ ws         : chr  NA NA NA NA ...
#>  $ metar      : chr  "24001KT CAVOK 01/M01 Q1023 NOSIG" "00000KT CAVOK 01/M00 Q1023 NOSIG" "00000KT CAVOK 00/M01 Q1022 NOSIG" "30001KT CAVOK 01/M01 Q1022 NOSIG" ...
#>  $ rmk        : chr  NA NA NA NA ...
#>  - attr(*, ".internal.selfref")=<externalptr>
```

### Example plot

``` r
library(ggplot2)
#> Warning: package 'ggplot2' was built under R version 3.6.2
ggplot(dat.parsed, aes(time, tt)) +
  geom_path() +
  labs(title = "Recent Temperature at LSZH Airport") +
  theme_bw()
```

<img src="man/figures/README-plot1-1.png" width="100%" />

### Data processing (cloud groups)

``` r
# Process cloud groups (1-4)
dat.cld <- metar_clouds(dat.parsed$cl)    
dat.cld$time <- dat.parsed$time

# Structure
str(dat.cld)
#> Classes 'data.table' and 'data.frame':   94 obs. of  15 variables:
#>  $ cld_levels : int  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_hgt_min: num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_hgt_max: num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_amt_max: chr  NA NA NA NA ...
#>  $ cld_amt_min: chr  NA NA NA NA ...
#>  $ ceiling    : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_str_1  : chr  NA NA NA NA ...
#>  $ cld_str_2  : chr  NA NA NA NA ...
#>  $ cld_amt_1  : chr  NA NA NA NA ...
#>  $ cld_amt_2  : chr  NA NA NA NA ...
#>  $ cld_hgt_1  : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_hgt_2  : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_type_1 : chr  NA NA NA NA ...
#>  $ cld_type_2 : chr  NA NA NA NA ...
#>  $ time       : POSIXct, format: "2021-04-25 00:50:00" "2021-04-25 01:20:00" ...
#>  - attr(*, ".internal.selfref")=<externalptr>

ggplot(dat.cld, aes(time, cld_hgt_1)) +
  geom_path() +
  labs(title = "Altitude of Lowest Cloud Level at LSZH Airport") +
  theme_bw()
#> Warning: Removed 24 row(s) containing missing values (geom_path).
```

<img src="man/figures/README-plot2-1.png" width="100%" />
