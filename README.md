
<!-- README.md is generated from README.Rmd. Please edit that file -->

# metar

The goal of **metar** is to provide an R-built parser for METAR reports.

## Installation

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("m-saenger/metar")
```

## Example

### Data retrieval and parsing

``` r
library(metar)
## read raw data from Mesonet website
dat <- read_mesonet("LSZH", as.POSIXct("2021-03-06"), as.POSIXct("2021-03-28"))
## parse METAR code
dat.parsed <- parse_metar(dat$metar)
# Structure
str(dat.parsed)
#> Classes 'data.table' and 'data.frame':   1032 obs. of  24 variables:
#>  $ icao       : chr  "LSZH" "LSZH" "LSZH" "LSZH" ...
#>  $ time       : POSIXct, format: "2021-04-05 00:50:00" "2021-04-05 01:20:00" ...
#>  $ auto       : chr  "0" "0" "0" "0" ...
#>  $ cor        : chr  "0" "0" "0" "0" ...
#>  $ wx         : chr  NA NA NA NA ...
#>  $ dir        : int  250 NA NA 110 NA 140 190 90 NA 140 ...
#>  $ ff         : num  4 2 2 2 2 3 2 2 2 3 ...
#>  $ fx         : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ dir_from   : int  NA NA NA NA NA NA NA NA NA NA ...
#>  $ dir_to     : int  NA NA NA NA NA NA NA NA NA NA ...
#>  $ vis        : num  9999 9999 9999 8000 7000 ...
#>  $ ndv        : chr  NA NA NA NA ...
#>  $ min_vis    : int  NA NA NA NA NA 500 NA NA NA NA ...
#>  $ min_vis_dir: chr  NA NA NA NA ...
#>  $ rvr        : chr  "" "" "" "" ...
#>  $ vvis       : chr  NA NA NA NA ...
#>  $ cld        : chr  "FEW012 BKN035" "FEW012 SCT030" "SCT040" "FEW040" ...
#>  $ tt         : num  7 6 6 5 5 4 4 4 4 5 ...
#>  $ td         : num  5 5 5 5 5 4 4 4 4 4 ...
#>  $ pw         : chr  "" "" "" "MIFG" ...
#>  $ qnh        : num  1019 1019 1019 1018 1018 ...
#>  $ ws         : chr  NA NA NA NA ...
#>  $ metar      : chr  "25004KT 9999 FEW012 BKN035 07/05 Q1019 NOSIG" "VRB02KT 9999 FEW012 SCT030 06/05 Q1019 NOSIG" "VRB02KT 9999 SCT040 06/05 Q1019 NOSIG" "11002KT 8000 MIFG FEW040 05/05 Q1018 NOSIG" ...
#>  $ rmk        : chr  NA NA NA NA ...
#>  - attr(*, ".internal.selfref")=<externalptr>
```

### Example plot

``` r
library(ggplot2)
#> Warning: package 'ggplot2' was built under R version 4.0.4
ggplot(dat.parsed, aes(time, tt)) +
  geom_path() +
  labs(title = "Recent Temperature at LSZH Airport") +
  theme_bw()
```

<img src="man/figures/README-plot1-1.png" width="100%" />

### Data processing (cloud groups)

``` r
# Process cloud groups (1-4)
dat.cld <- metar_clouds(dat.parsed$cl)    
dat.cld$time <- dat.parsed$time
# Structure
str(dat.cld)
#> Classes 'data.table' and 'data.frame':   1032 obs. of  23 variables:
#>  $ cld_levels : int  2 2 1 1 1 1 1 2 3 3 ...
#>  $ cld_hgt_min: num  1200 1200 4000 4000 1200 1200 1400 1200 1200 1000 ...
#>  $ cld_hgt_max: num  3500 3000 4000 4000 1200 1200 1400 5000 7500 7500 ...
#>  $ cld_amt_max: chr  "BKN" "SCT" "SCT" "FEW" ...
#>  $ cld_amt_min: chr  "FEW" "FEW" "SCT" "FEW" ...
#>  $ ceiling    : num  3500 NA NA NA NA NA NA NA 7500 7500 ...
#>  $ cld_str_1  : chr  "FEW012" "FEW012" "SCT040" "FEW040" ...
#>  $ cld_str_2  : chr  "BKN035" "SCT030" NA NA ...
#>  $ cld_str_3  : chr  NA NA NA NA ...
#>  $ cld_str_4  : chr  NA NA NA NA ...
#>  $ cld_amt_1  : chr  "FEW" "FEW" "SCT" "FEW" ...
#>  $ cld_amt_2  : chr  "BKN" "SCT" NA NA ...
#>  $ cld_amt_3  : chr  NA NA NA NA ...
#>  $ cld_amt_4  : chr  NA NA NA NA ...
#>  $ cld_hgt_1  : num  1200 1200 4000 4000 1200 1200 1400 1200 1200 1000 ...
#>  $ cld_hgt_2  : num  3500 3000 NA NA NA NA NA 5000 3500 4000 ...
#>  $ cld_hgt_3  : num  NA NA NA NA NA NA NA NA 7500 7500 ...
#>  $ cld_hgt_4  : num  NA NA NA NA NA NA NA NA NA NA ...
#>  $ cld_type_1 : chr  NA NA NA NA ...
#>  $ cld_type_2 : chr  NA NA NA NA ...
#>  $ cld_type_3 : chr  NA NA NA NA ...
#>  $ cld_type_4 : chr  NA NA NA NA ...
#>  $ time       : POSIXct, format: "2021-04-05 00:50:00" "2021-04-05 01:20:00" ...
#>  - attr(*, ".internal.selfref")=<externalptr>
ggplot(dat.cld, aes(time, cld_hgt_1)) +
  geom_path() +
  labs(title = "Altitude of Lowest Cloud Level at LSZH Airport") +
  theme_bw()
```

<img src="man/figures/README-plot2-1.png" width="100%" />

### METARgram

``` r
dat.1 <- cbind(dat.parsed, dat.parsed[, metar_pw(pw)])
print(dat.1$FG)
#>    [1] 0 0 0 1 1 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>   [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>   [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [112] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [149] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [186] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [223] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 0 0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0
#>  [260] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [297] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [334] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [371] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [408] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [445] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [482] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [519] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [556] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [593] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [630] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [667] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [704] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [741] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [778] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [815] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [852] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [889] 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [926] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#>  [963] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
#> [1000] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
plot_metargram(dat = dat.1, cex = .8)
```

<img src="man/figures/README-plot3-1.png" width="100%" />
